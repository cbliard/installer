#!/bin/bash

set -e
set -o pipefail

export INSTALLER_DIR=${INSTALLER_DIR:="${APP_HOME}/.pkgr/installer"}
export DIALOG=${DIALOG:="dialog"}
export DIALOGRC="${INSTALLER_DIR}/debian.rc"

echo "Launching installer for ${APP_NAME}..."

echoerr() { echo "$@" 1>&2; }

for_each_addon() {
	for addon in ${ADDONS}; do
		echoerr "[${addon}] $@"
		( cd ${INSTALLER_DIR}/addons/${addon} && exec "$@" )
	done
}

# execute configure scripts
for_each_addon ./bin/configure

# execute preinstall scripts
for_each_addon ./bin/preinstall

# execute postinstall scripts
for_each_addon ./bin/postinstall
